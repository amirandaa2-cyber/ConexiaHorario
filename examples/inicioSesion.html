<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bienvenido a BigFood</title>
    <link rel="stylesheet" href="/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Bowlby+One&display=swap" rel="stylesheet">
    <style>
        .hero-section {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        
        .section {
            padding: 80px 20px;
            background: var(--bg-white);
        }
        
        .about-section {
            display: flex;
            max-width: 1200px;
            margin: 0 auto;
            gap: 50px;
            align-items: center;
        }
        
        .about-content {
            flex: 1;
        }
        
        .about-image {
            width: 400px;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgb(0, 0, 0);
        }
        
        .section-title {
            font-size: 2.5rem;
            color: var(--text-primary);
            margin-bottom: 30px;
            position: relative;
            padding-bottom: 15px;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 4px;
            background: #18944c;
            border-radius: 2px;
        }
        
        .reviews-section {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }
        
        .reviews-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 50px;
        }
        
        .review-card {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .review-card:hover {
            transform: translateY(-10px);
        }
        
        .stars {
            color: #ffd700;
            margin: 15px 0;
        }
        
        .contact-section {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        
        .contact-form {
            display: grid;
            gap: 20px;
            margin-top: 40px;
        }
        
        .contact-form input,
        .contact-form select,
        .contact-form textarea {
            padding: 15px;
            border: 2px solid var(--input-border);
            border-radius: 8px;
            font-size: 1rem;
            width: 100%;
            background: var(--bg-white);
            color: var(--text-primary);
        }
        
        .contact-form button {
            background: #18944c;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .contact-form button:hover {
            background: #147a3e;
        }

        .login-error {
            color: #ef4444;
            font-weight: 600;
            min-height: 20px;
            margin: 6px 0;
        }

        .login-divider {
            display: flex;
            align-items: center;
            gap: 12px;
            color: #9ca3af;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin: 18px 0;
        }

        .login-divider::before,
        .login-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: #e5e7eb;
        }

        #google-signin {
            display: none;
            justify-content: center;
        }

        .cont-formulario.is-loading .boton-principal {
            opacity: 0.6;
            pointer-events: none;
        }
        
        .scroll-indicator {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            animation: bounce 2s infinite;
            color: var(--text-primary);
            font-size: 2rem;
            cursor: pointer;
        }

        /* Make the scroll arrow white */
        .scroll-indicator i { color: #fff !important; }

        /* Make the floating menu '+' icon white */
        .menu-content .menu-item#menu,
        .menu-content .menu-item#menu i { color: #fff !important; }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-30px);
            }
            60% {
                transform: translateY(-15px);
            }
        }
        
        @media (max-width: 768px) {
            .about-section {
                flex-direction: column;
                text-align: center;
            }
            
            .about-image {
                width: 100%;
                max-width: 400px;
            }
            
            .section-title::after {
                left: 50%;
                transform: translateX(-50%);
            }
            
            .reviews-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="theme-switch-wrapper">
        <label class="theme-switch" for="checkbox">
            <input type="checkbox" id="checkbox" />
            <div class="slider"></div>
        </label>
    </div>

            <div class="contenedor contenedor-login">
                <div class="contenedor-titulo">
                    <h1 class="titulo animate-title">Bienvenido a</h1>
                    <h1 class="titulo2 logo-estilo animate-logo">BigFood</h1>
                </div>

                <form class="cont-formulario" novalidate>
                    <input type="text" class="input" id="nombre" name="nombre" placeholder="Usuario o correo institucional" autocomplete="username" required>
                    <input type="password" class="input" id="password" name="password" placeholder="Contraseña" autocomplete="current-password" required>
                    <p class="login-error" id="login-error" aria-live="polite"></p>
                    <input type="submit" value="Ingresar" class="boton-enviar boton-principal" id="ingresar">
                </form>
                <div class="login-divider"><span>o</span></div>
                <div id="google-signin" aria-live="polite"></div>
            </div>

    <script>
        const btnMenu = document.querySelector('#menu'),
            menuContent = document.querySelector('.menu-content');

        btnMenu.addEventListener('click', () => {
            menuContent.classList.toggle('menu-active');
        });

        // Smooth scroll para el indicador de scroll y navegación
        document.querySelector('.scroll-indicator').addEventListener('click', () => {
            document.querySelector('#about').scrollIntoView({
                behavior: 'smooth'
            });
        });

        // Animación de aparición al hacer scroll
        const sections = document.querySelectorAll('.section');
        const observerOptions = {
            threshold: 0.1
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        sections.forEach(section => {
            section.style.opacity = '0';
            section.style.transform = 'translateY(50px)';
            section.style.transition = 'all 0.6s ease-out';
            observer.observe(section);
        });
    </script>
    
    <!-- Additional scripts (theme toggle + animated icons) -->
    <script>
    (function(){
        // Control del tema oscuro
        const toggleSwitch = document.querySelector('#checkbox');
        try {
            const currentTheme = localStorage.getItem('theme');
            if (currentTheme) {
                document.documentElement.setAttribute('data-theme', currentTheme);
                if (currentTheme === 'dark') toggleSwitch.checked = true;
            }

            toggleSwitch.addEventListener('change', function(e) {
                if (e.target.checked) {
                    document.documentElement.setAttribute('data-theme', 'dark');
                    localStorage.setItem('theme', 'dark');
                } else {
                    document.documentElement.setAttribute('data-theme', 'light');
                    localStorage.setItem('theme', 'light');
                }
            });
        } catch (err) {
            // In case toggleSwitch is not present or storage access fails, fail silently
            console.warn('Theme toggle init failed', err);
        }

        // Inicializar posiciones de iconos animados
        const iconos = document.querySelectorAll('.fondo-animado .icono');
        iconos.forEach(icono => {
            icono.style.left = Math.random() * 100 + '%';
            icono.style.top = -Math.random() * 100 + 'vh';
            const duracion = 10 + Math.random() * 10;
            icono.style.animationDuration = duracion + 's';
            icono.style.animationDelay = Math.random() * 5 + 's';
        });
    })();

        </script>

        <script>
            (function initAdminLogin(){
                function resolveApiBase(){
                    const fallbackOrigin = (window.location && window.location.origin && window.location.origin !== 'null')
                        ? window.location.origin.replace(/\/$/, '')
                        : 'http://localhost:3001';
                    const resolved = window.APP_API_URL || (fallbackOrigin + '/api');
                    window.APP_API_URL = resolved;
                    return resolved;
                }
                const API_BASE = resolveApiBase();
                window.__APP_API_BASE = API_BASE;
                if (typeof window !== 'undefined' && window.APP_USE_API === undefined) {
                    window.APP_USE_API = window.location ? window.location.protocol !== 'file:' : false;
                }
                const form = document.querySelector('.cont-formulario');
                const identifierInput = document.getElementById('nombre');
                const passwordInput = document.getElementById('password');
                const errorEl = document.getElementById('login-error');

                if (!form || !identifierInput || !passwordInput) {
                    return;
                }

                function persistSessionFromPayload(payload){
                    if (payload?.token) {
                        localStorage.setItem('proto_admin_token', payload.token);
                    }
                    if (payload?.expiresAt) {
                        localStorage.setItem('proto_admin_session_exp', payload.expiresAt);
                    }
                    if (payload?.user) {
                        const displayName = payload.user.username || payload.user.email;
                        localStorage.setItem('proto_admin_username', displayName);
                    }
                    localStorage.setItem('proto_admin_session_v1', '1');
                }

                window.__persistAdminSession = persistSessionFromPayload;

                async function handleLogin(evt){
                    evt.preventDefault();
                    if (errorEl) errorEl.textContent = '';
                    form.classList.add('is-loading');
                    const identifier = identifierInput.value.trim();
                    const password = passwordInput.value;
                    try {
                        const response = await fetch(API_BASE + '/auth/login', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ identifier, password })
                        });
                        const payload = await response.json().catch(()=>({}));
                        if (!response.ok) {
                            throw new Error(payload.error || 'No se pudo iniciar sesión.');
                        }
                        persistSessionFromPayload(payload);
                        window.location.href = 'timegrid-views.html';
                    } catch (err) {
                        console.error('Login error', err);
                        if (errorEl) {
                            errorEl.textContent = err.message || 'Error al iniciar sesión.';
                        }
                    } finally {
                        form.classList.remove('is-loading');
                    }
                }

                form.addEventListener('submit', handleLogin);
            })();
        </script>

        <script>
            (function setupGoogleLogin(){
                const googleContainer = document.getElementById('google-signin');
                const errorEl = document.getElementById('login-error');
                const form = document.querySelector('.cont-formulario');
                if (!googleContainer) { return; }

                const API_BASE = window.__APP_API_BASE || window.APP_API_URL || 'http://localhost:3001/api';

                function showError(message){ if (errorEl) errorEl.textContent = message; }

                function persist(payload){
                    if (typeof window.__persistAdminSession === 'function') {
                        window.__persistAdminSession(payload);
                    }
                }

                async function loadPublicConfig(){
                    try {
                        const resp = await fetch(API_BASE + '/public-config');
                        if (resp.ok) {
                            return await resp.json();
                        }
                    } catch (err) {
                        console.warn('No se pudo cargar la configuración pública', err);
                    }
                    return {};
                }

                function ensureGoogleScript(onReady){
                    if (window.google && window.google.accounts && window.google.accounts.id) {
                        onReady();
                        return;
                    }
                    const script = document.createElement('script');
                    script.src = 'https://accounts.google.com/gsi/client';
                    script.async = true;
                    script.defer = true;
                    script.onload = onReady;
                    script.onerror = () => console.warn('No se pudo cargar Google Identity Services');
                    document.head.appendChild(script);
                }

                function renderGoogleButton(clientId){
                    if (!clientId || !(window.google && window.google.accounts && window.google.accounts.id)) {
                        googleContainer.style.display = 'none';
                        return;
                    }
                    googleContainer.style.display = 'flex';
                    window.google.accounts.id.initialize({
                        client_id: clientId,
                        callback: onCredentialResponse,
                        auto_select: false,
                        use_fedcm_for_prompt: true
                    });
                    window.google.accounts.id.renderButton(googleContainer, {
                        theme: 'outline',
                        size: 'large',
                        text: 'signin_with',
                        shape: 'pill',
                        width: 320
                    });
                }

                async function onCredentialResponse(response){
                    if (!response || !response.credential) {
                        showError('No se recibió la credencial de Google.');
                        return;
                    }
                    if (errorEl) errorEl.textContent = '';
                    form?.classList.add('is-loading');
                    try {
                        const resp = await fetch(API_BASE + '/auth/google', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ credential: response.credential })
                        });
                        const payload = await resp.json().catch(()=>({}));
                        if (!resp.ok) {
                            throw new Error(payload.error || 'No se pudo iniciar sesión con Google.');
                        }
                        persist(payload);
                        window.location.href = 'timegrid-views.html';
                    } catch (err) {
                        console.error('Google login error', err);
                        showError(err.message || 'No se pudo iniciar sesión con Google.');
                    } finally {
                        form?.classList.remove('is-loading');
                    }
                }

                loadPublicConfig().then(config => {
                    const clientId = config.googleClientId || window.APP_GOOGLE_CLIENT_ID || null;
                    if (!clientId) {
                        googleContainer.style.display = 'none';
                        return;
                    }
                    ensureGoogleScript(() => renderGoogleButton(clientId));
                });
            })();
        </script>

        <!-- Modal para palabra baneada -->
        <style>
            #bannedModal{position:fixed;left:0;top:0;right:0;bottom:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.5);z-index:9999}
            #bannedModal .modal-box{background:white;padding:20px;border-radius:8px;max-width:420px;width:90%;box-shadow:0 10px 30px rgba(0,0,0,.2)}
            #bannedModal .modal-box h3{margin:0 0 8px;font-size:1.1rem}
            #bannedModal .modal-box p{margin:0 0 12px;color:#333}
            #bannedModal .modal-actions{text-align:right}
            #bannedModal .modal-actions button{margin-left:8px;padding:8px 12px;border-radius:6px;border:0;cursor:pointer}
            #bannedModal .btn-ok{background:#18944c;color:#fff}
            #bannedModal .btn-edit{background:#e0e0e0}
        </style>

        <div id="bannedModal" aria-hidden="true">
            <div class="modal-box" role="dialog" aria-modal="true">
                <h3>Palabra indebida detectada</h3>
                <p id="bannedMessage">Se ha detectado una palabra o frase no permitida. Por favor cámbiala para continuar.</p>
                <div class="modal-actions">
                    <button class="btn-edit" id="bannedEdit">Editar</button>
                    <button class="btn-ok" id="bannedOk">OK</button>
                </div>
            </div>
        </div>

        <script>
            // Lista cliente de tokens prohibidos (coincide con el servidor). Mantener en minúsculas.
            const BANNED_TOKENS = [
                'mierda','hijo de puta','puta madre','puta','cabron','fuck','shit','tula','pichula','weon','webon','conchetumare','conchetumadre','putito','pablo','brian','pene','culo','raja','tetita','milf',
                'drop database','drop table','delete from','truncate','insert','update','alter table','exec ','union select','or 1=1','--','/**/'
            ];

            // Escapar regex
            const esc = s => String(s).replace(/[\\^$.*+?()\[\]{}|]/g, '\\$&');

            // Build checks that handle words/phrases: for tokens that are pure word chars, use \b boundaries, otherwise simple contains
            function findBannedInText(text){
                if(!text) return null;
                const t = String(text).toLowerCase();
                for(const token of BANNED_TOKENS){
                    const tok = token.toLowerCase();
                    // if token contains only letters/numbers/underscore, use word boundary
                    if(/^\w+$/.test(tok)){
                        const re = new RegExp('\\b'+esc(tok)+'\\b','i');
                        if(re.test(t)) return token;
                    } else {
                        if(t.indexOf(tok) !== -1) return token;
                    }
                }
                return null;
            }

            // Modal helpers
            const bannedModal = document.getElementById('bannedModal');
            const bannedMessage = document.getElementById('bannedMessage');
            const bannedOk = document.getElementById('bannedOk');
            const bannedEdit = document.getElementById('bannedEdit');
            let lastOffendingInput = null;

            function showBannedModal(token, inputEl){
                bannedMessage.textContent = `Se ha detectado: "${token}". Por favor cámbialo para continuar.`;
                lastOffendingInput = inputEl || null;
                bannedModal.style.display = 'flex';
                bannedModal.setAttribute('aria-hidden','false');
            }
            function hideBannedModal(){
                bannedModal.style.display = 'none';
                bannedModal.setAttribute('aria-hidden','true');
                if(lastOffendingInput) lastOffendingInput.focus();
            }

            bannedOk.addEventListener('click', hideBannedModal);
            bannedEdit.addEventListener('click', hideBannedModal);

            // Intercept form submissions and validate inputs
            function bindFormValidation(form){
                if(!form) return;
                form.addEventListener('submit', function(e){
                    // collect all text-like fields
                    const inputs = Array.from(form.querySelectorAll('input,textarea,select')).filter(el=>el.type!=='hidden' && !el.disabled);
                    for(const inp of inputs){
                        const val = inp.value;
                        const found = findBannedInText(val);
                        if(found){
                            e.preventDefault();
                            showBannedModal(found, inp);
                            return false;
                        }
                    }
                    // allow submit
                }, {capture:true});
            }

            // Bind to the main login/contact forms on this page
            document.addEventListener('DOMContentLoaded', function(){
                const loginForm = document.querySelector('.cont-formulario');
                const contactForm = document.getElementById('contactForm');
                bindFormValidation(loginForm);
                bindFormValidation(contactForm);
            });
        </script>

        </body>

</html>

